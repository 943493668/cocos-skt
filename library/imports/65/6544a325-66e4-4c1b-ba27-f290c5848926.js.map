{"version":3,"sources":["assets/script/longin/login.js"],"names":["require","wxcur","basis","cc","Class","Component","properties","jindut","Node","jindushuliang","Label","langan","onLoad","runAction","moveTo","v2","loading","sys","platform","WECHAT_GAME","systemInfo","wx","getSystemInfoSync","Launch","getLaunchOptionsSync","webserver","console","log","getStorageSync","openvibration","openMusic","ajax","then","res","Object","assign","boothLevel1Glod","Number","boothLevel2Glod","boothLevel3Glod","boothLevel4Glod","beatEachDropMoney","wx_login","code","data","AppPlatform","isbanben","openid","jindubaifenbi","err","event","resource","director","preloadScene","_progressCallback","bind","_completeCallback","completeCount","totalCount","progress","x","width","string","toFixed","texture","loadScene"],"mappings":"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","sourceRoot":"/","sourcesContent":["\nconst { wxcur } = require('weixin_ty');\nconst { basis } = require('basis');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        jindut: cc.Node,\n        jindushuliang: cc.Label,\n        langan: cc.Node\n    },\n\n    onLoad() {\n        this.langan.runAction(\n            cc.moveTo(10, cc.v2(-800, -273))\n        )\n        this.loading();\n    },\n    loading() {\n        if (cc.sys.platform === cc.sys.WECHAT_GAME) {\n            var systemInfo = wx.getSystemInfoSync();\n            const Launch = wx.getLaunchOptionsSync();\n\n            //wxcur.webserver = 'https://apptest.yishutech.cn/home/';\n            wxcur.webserver = 'https://short.yishutech.cn/stall/';\n\n            console.log(Launch, wx.getStorageSync('openvibration'))\n\n            basis.openvibration = wx.getStorageSync('openvibration') === '' ? true : false;\n            basis.openMusic = wx.getStorageSync('openMusic') === '' ? true : false;\n\n            //\n            wxcur.ajax('index').then(res => {\n                Object.assign(basis, res)\n\n                basis.boothLevel1Glod = Number(res.boothLevel1Glod);\n                basis.boothLevel2Glod = Number(res.boothLevel2Glod);\n                basis.boothLevel3Glod = Number(res.boothLevel3Glod);\n                basis.boothLevel4Glod = Number(res.boothLevel4Glod);\n                basis.beatEachDropMoney = Number(res.beatEachDropMoney);\n            })\n\n            wxcur.wx_login().then(res => {\n                console.log(res, \"login\");\n                basis.code = res.code;\n                const data = {\n                    code: res.code\n                }\n\n                if (systemInfo.AppPlatform == \"qq\") {\n                    console.log(\"qq\")\n                    basis.isbanben = \"qq\";\n                    return wxcur.ajax(\"qqlogin\", data);\n                } else {\n                    console.log(\"weixin\")\n                    basis.isbanben = \"wx\";\n                    return wxcur.ajax(\"login\", data);\n                }\n            }).then(res => {\n                console.log(res, \"res\")\n                basis.openid = res.openid;\n                //basis.openid = \"310CB40B6FFC348F622D8C9D09C92FF7\";\n                return wxcur.ajax(\"info\", { openid: basis.openid })\n            }).then(res => {\n\n                // wxcur.butshare = {\n                //     butsharetxt: basis.sharetitle,\n                //     butshareimageUrl: `${basis.gender == 1 ? basis.shareimg1 : basis.shareimg2}`,\n                //     butsharequery: 'fid=' + res.homeinfo.id\n                // }\n\n                this.jindubaifenbi();\n\n            }).catch(err => {\n                console.log(err, \"err\");\n                //this.loading();\n            })\n            // }).catch(err => {\n\n            // })\n\n\n        } else {\n\n            this.jindubaifenbi();\n        }\n\n        console.log(basis)\n    },\n    jindubaifenbi() {\n        console.log('开始加载')\n        if (cc.sys.platform === cc.sys.WECHAT_GAME) {\n            wxcur.ajax('stat', { openid: basis.openid, event: \"start\" })\n        }\n        this.resource = null;\n        cc.director.preloadScene('index', this._progressCallback.bind(this), this._completeCallback.bind(this))\n    },\n    _progressCallback(completeCount, totalCount, res) {\n        //加载进度回调 \n        this.progress = completeCount / totalCount;\n        this.jindut.x = -(this.jindut.width - (this.jindut.width * this.progress));\n        this.jindushuliang.string = `${(this.progress * 100).toFixed(2)}%`;\n    },\n\n    _completeCallback(err, texture) {\n        //加载完成回调\n        if (cc.sys.platform === cc.sys.WECHAT_GAME) {\n            wxcur.ajax('stat', { openid: basis.openid, event: \"inhome\" })\n        }\n\n        if (err) {\n            console.log(err, '请求超时！');\n        }\n        cc.director.loadScene(\"index\");\n    },\n});\n"]}