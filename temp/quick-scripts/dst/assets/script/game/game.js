
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/script/game/game.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '71594oT51RBKbgnhq570hLb', 'game');
// script/game/game.js

"use strict";

var _followerlist = require("./followerlist.js");

var _interact = require("./interact.js");

var _music = require("./../currency/music.js");

var _require = require('weixin_ty'),
    wxcur = _require.wxcur;

var _require2 = require('basis'),
    basis = _require2.basis;

var game = cc.Class({
  "extends": cc.Component,
  properties: {
    dianchumb: cc.Node,
    caozuodi: cc.Node,
    caozuoopan: cc.Node,
    renwu: cc.Node,
    camera: cc.Node
  },
  onLoad: function onLoad() {
    game._this = this;
    this.gameStart = true;
    this.renwu.zIndex = 999999;
    this.renwu = this.renwu.getComponent('renwu');
    var manager = cc.director.getCollisionManager();
    manager.enabled = true; //manager.enabledDebugDraw = true;
    //manager.enabledDrawBoundingBox = true;

    this.dianchumb.on(cc.Node.EventType.TOUCH_START, this.touchStart, this);
    this.dianchumb.on(cc.Node.EventType.TOUCH_MOVE, this.touchMove, this);
    this.dianchumb.on(cc.Node.EventType.TOUCH_END, this.touchEnd, this);
    this.renwu.zIndex = 2;
    var imgarr = ['001', '002', '003', '004', '005', '006', '007', '008', '009', '010', '011', '012'];
    imgarr.splice(imgarr.findIndex(function (res) {
      return res == basis.myfigure.imgName;
    }), 1);
    this.aiRomImg = this.randomArr(imgarr, basis.aiNum);
    console.log(this.aiRomImg);
    this.getCanvMoreHeight();
  },
  randomArr: function randomArr(arr, num) {
    var newArr = []; //创建一个新数组

    for (var i = 0; i < num; i++) {
      var temp = Math.floor(Math.random() * arr.length); //取随机下标

      newArr.push(arr[temp]); //添加到新数组

      arr.splice(temp, 1); //删除当前的数组元素,避免重复
    }

    return newArr;
  },
  start: function start() {
    this.bgm = _music.music._this.openMusic('', 'bgm2', true);
  },
  getCanvMoreHeight: function getCanvMoreHeight() {
    var size = cc.view.getFrameSize();
    this.height = 667 * size.width / 375 - size.height > 0 ? 0 : 667 * size.width / 375 - size.height;
    this.width = size.width;
  },
  touchStart: function touchStart(e) {
    if (this.renwu.death) return;
    this.yidongfig = true;
    this.touchStart = e.getLocation();
    this.caozuodi.stopAllActions();
    this.caozuodi.opacity = 255;
    this.caozuodi.y = this.touchStart.y - 667 + this.height;
    this.caozuodi.x = this.touchStart.x - 375;
  },
  touchMove: function touchMove(e) {
    if (this.renwu.death || !this.gameStart) {
      this.yidongfig = false;
      return;
    }

    ;
    var delta = e.getDelta();
    var angle = this.angle = wxcur.getAngle(0, 0, this.caozuoopan.x + delta.x, this.caozuoopan.y + delta.y);
    var hudu = angle * Math.PI / 180;
    var xiebian = Math.pow(Math.pow(this.caozuoopan.x + delta.x, 2) + Math.pow(this.caozuoopan.y + delta.y, 2), 0.5);
    var maxxiebian = Math.pow(Math.pow(191 / 2 * Math.sin(hudu), 2) + Math.pow(186 / 2 * Math.cos(hudu), 2), 0.5);

    if (xiebian >= maxxiebian) {
      this.caozuoopan.x = 191 / 2 * Math.sin(hudu);
      this.caozuoopan.y = 186 / 2 * Math.cos(hudu);
    } else {
      this.caozuoopan.x += delta.x;
      this.caozuoopan.y += delta.y;
    }
  },
  touchEnd: function touchEnd(e) {
    this.yidongfig = false;
    this.caozuoopan.y = 0;
    this.caozuoopan.x = 0;
    this.caozuodi.runAction(cc.fadeOut(0.5));
  },
  ydshijiao: function ydshijiao() {
    this.camera.x = this.renwu.node.x;
    this.camera.y = this.renwu.node.y;

    if (this.yidongfig) {
      _interact.interact._this.gaoguang.x = this.renwu.node.x;
      _interact.interact._this.gaoguang.y = this.renwu.node.y;
      this.renwu.yidong(this.angle);
    } else {
      this.renwu.node.yidongfig = false;
    }
  },
  yingcang: function yingcang(node) {
    var size = cc.view.getFrameSize();

    var v2 = game._this.camera.convertToNodeSpaceAR(cc.v2(node.x, node.y));

    v2.x += size.width;
    v2.y += size.height;

    if (v2.x > size.width + node.width / 2 || v2.x < -size.width - node.width / 2 || v2.y < -size.height - node.height / 2 || v2.y > size.height + node.height / 2) {
      node.opacity = 0;
    } else {
      node.opacity = 255;
    }
  },
  update: function update() {
    this.ydshijiao();
  }
});
exports.game = game;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHQvZ2FtZS9nYW1lLmpzIl0sIm5hbWVzIjpbInJlcXVpcmUiLCJ3eGN1ciIsImJhc2lzIiwiZ2FtZSIsImNjIiwiQ2xhc3MiLCJDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwiZGlhbmNodW1iIiwiTm9kZSIsImNhb3p1b2RpIiwiY2FvenVvb3BhbiIsInJlbnd1IiwiY2FtZXJhIiwib25Mb2FkIiwiX3RoaXMiLCJnYW1lU3RhcnQiLCJ6SW5kZXgiLCJnZXRDb21wb25lbnQiLCJtYW5hZ2VyIiwiZGlyZWN0b3IiLCJnZXRDb2xsaXNpb25NYW5hZ2VyIiwiZW5hYmxlZCIsIm9uIiwiRXZlbnRUeXBlIiwiVE9VQ0hfU1RBUlQiLCJ0b3VjaFN0YXJ0IiwiVE9VQ0hfTU9WRSIsInRvdWNoTW92ZSIsIlRPVUNIX0VORCIsInRvdWNoRW5kIiwiaW1nYXJyIiwic3BsaWNlIiwiZmluZEluZGV4IiwicmVzIiwibXlmaWd1cmUiLCJpbWdOYW1lIiwiYWlSb21JbWciLCJyYW5kb21BcnIiLCJhaU51bSIsImNvbnNvbGUiLCJsb2ciLCJnZXRDYW52TW9yZUhlaWdodCIsImFyciIsIm51bSIsIm5ld0FyciIsImkiLCJ0ZW1wIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwibGVuZ3RoIiwicHVzaCIsInN0YXJ0IiwiYmdtIiwibXVzaWMiLCJvcGVuTXVzaWMiLCJzaXplIiwidmlldyIsImdldEZyYW1lU2l6ZSIsImhlaWdodCIsIndpZHRoIiwiZSIsImRlYXRoIiwieWlkb25nZmlnIiwiZ2V0TG9jYXRpb24iLCJzdG9wQWxsQWN0aW9ucyIsIm9wYWNpdHkiLCJ5IiwieCIsImRlbHRhIiwiZ2V0RGVsdGEiLCJhbmdsZSIsImdldEFuZ2xlIiwiaHVkdSIsIlBJIiwieGllYmlhbiIsInBvdyIsIm1heHhpZWJpYW4iLCJzaW4iLCJjb3MiLCJydW5BY3Rpb24iLCJmYWRlT3V0IiwieWRzaGlqaWFvIiwibm9kZSIsImludGVyYWN0IiwiZ2FvZ3VhbmciLCJ5aWRv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R0FBUSxDQUFDWixJQUFJLENBQUNJLEtBQU4sR0FBY3VCLElBQUksQ0FBQ3ZCLEtBQUwsR0FBYSxDQUEzRSxJQUFpRjRCLEVBQUUsQ0FBQ3JCLENBQUgsR0FBUSxDQUFDWCxJQUFJLENBQUNHLE1BQU4sR0FBZXdCLElBQUksQ0FBQ3hCLE1BQUwsR0FBYyxDQUF0SCxJQUE0SDZCLEVBQUUsQ0FBQ3JCLENBQUgsR0FBUVgsSUFBSSxDQUFDRyxNQUFMLEdBQWN3QixJQUFJLENBQUN4QixNQUFMLEdBQWMsQ0FBcEssRUFBd0s7QUFDcEt3QixNQUFBQSxJQUFJLENBQUNqQixPQUFMLEdBQWUsQ0FBZjtBQUNILEtBRkQsTUFFTztBQUNIaUIsTUFBQUEsSUFBSSxDQUFDakIsT0FBTCxHQUFlLEdBQWY7QUFDSDtBQUNKLEdBbkhpQjtBQW9IbEJ3QixFQUFBQSxNQXBIa0Isb0JBb0hUO0FBQ0wsU0FBS1IsU0FBTDtBQUNIO0FBdEhpQixDQUFULENBQWI7QUEwSEFTLE9BQU8sQ0FBQ3pGLElBQVIsR0FBZUEsSUFBZiIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiXG5jb25zdCB7IHd4Y3VyIH0gPSByZXF1aXJlKCd3ZWl4aW5fdHknKTtcbmNvbnN0IHsgYmFzaXMgfSA9IHJlcXVpcmUoJ2Jhc2lzJyk7XG5cbmltcG9ydCB7IGZvbGxvd2VybGlzdCB9IGZyb20gJy4vZm9sbG93ZXJsaXN0LmpzJ1xuaW1wb3J0IHsgaW50ZXJhY3QgfSBmcm9tICcuL2ludGVyYWN0LmpzJ1xuaW1wb3J0IHsgbXVzaWMgfSBmcm9tICcuLy4uL2N1cnJlbmN5L211c2ljLmpzJztcblxuY29uc3QgZ2FtZSA9IGNjLkNsYXNzKHtcbiAgICBleHRlbmRzOiBjYy5Db21wb25lbnQsXG5cbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIGRpYW5jaHVtYjogY2MuTm9kZSxcbiAgICAgICAgY2FvenVvZGk6IGNjLk5vZGUsXG4gICAgICAgIGNhb3p1b29wYW46IGNjLk5vZGUsXG4gICAgICAgIHJlbnd1OiBjYy5Ob2RlLFxuICAgICAgICBjYW1lcmE6IGNjLk5vZGUsXG4gICAgfSxcblxuICAgIG9uTG9hZCgpIHtcbiAgICAgICAgZ2FtZS5fdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgdGhpcy5nYW1lU3RhcnQgPSB0cnVlO1xuXG4gICAgICAgIHRoaXMucmVud3UuekluZGV4ID0gOTk5OTk5O1xuICAgICAgICB0aGlzLnJlbnd1ID0gdGhpcy5yZW53dS5nZXRDb21wb25lbnQoJ3Jlbnd1Jyk7XG5cblxuICAgICAgICB2YXIgbWFuYWdlciA9IGNjLmRpcmVjdG9yLmdldENvbGxpc2lvbk1hbmFnZXIoKTtcbiAgICAgICAgbWFuYWdlci5lbmFibGVkID0gdHJ1ZTtcbiAgICAgICAgLy9tYW5hZ2VyLmVuYWJsZWREZWJ1Z0RyYXcgPSB0cnVlO1xuICAgICAgICAvL21hbmFnZXIuZW5hYmxlZERyYXdCb3VuZGluZ0JveCA9IHRydWU7XG5cbiAgICAgICAgdGhpcy5kaWFuY2h1bWIub24oY2MuTm9kZS5FdmVudFR5cGUuVE9VQ0hfU1RBUlQsIHRoaXMudG91Y2hTdGFydCwgdGhpcyk7XG4gICAgICAgIHRoaXMuZGlhbmNodW1iLm9uKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX01PVkUsIHRoaXMudG91Y2hNb3ZlLCB0aGlzKTtcbiAgICAgICAgdGhpcy5kaWFuY2h1bWIub24oY2MuTm9kZS5FdmVudFR5cGUuVE9VQ0hfRU5ELCB0aGlzLnRvdWNoRW5kLCB0aGlzKTtcblxuICAgICAgICB0aGlzLnJlbnd1LnpJbmRleCA9IDI7XG4gICAgICAgIGNvbnN0IGltZ2FyciA9IFsnMDAxJywgJzAwMicsICcwMDMnLCAnMDA0JywgJzAwNScsICcwMDYnLCAnMDA3JywgJzAwOCcsICcwMDknLCAnMDEwJywgJzAxMScsICcwMTInXVxuXG4gICAgICAgIGltZ2Fyci5zcGxpY2UoaW1nYXJyLmZpbmRJbmRleChyZXMgPT4gcmVzID09IGJhc2lzLm15ZmlndXJlLmltZ05hbWUpLCAxKTtcblxuICAgICAgICB0aGlzLmFpUm9tSW1nID0gdGhpcy5yYW5kb21BcnIoaW1nYXJyLCBiYXNpcy5haU51bSk7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuYWlSb21JbWcpXG4gICAgICAgIHRoaXMuZ2V0Q2Fudk1vcmVIZWlnaHQoKTtcbiAgICB9LFxuICAgIHJhbmRvbUFycihhcnIsIG51bSkge1xuICAgICAgICBsZXQgbmV3QXJyID0gW107Ly/liJvlu7rkuIDkuKrmlrDmlbDnu4RcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW07IGkrKykge1xuICAgICAgICAgICAgbGV0IHRlbXAgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBhcnIubGVuZ3RoKTsvL+WPlumaj+acuuS4i+agh1xuICAgICAgICAgICAgbmV3QXJyLnB1c2goYXJyW3RlbXBdKTsvL+a3u+WKoOWIsOaWsOaVsOe7hFxuICAgICAgICAgICAgYXJyLnNwbGljZSh0ZW1wLCAxKS8v5Yig6Zmk5b2T5YmN55qE5pWw57uE5YWD57SgLOmBv+WFjemHjeWkjVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXdBcnI7XG4gICAgfSxcbiAgICBzdGFydCgpIHtcbiAgICAgICAgdGhpcy5iZ20gPSBtdXNpYy5fdGhpcy5vcGVuTXVzaWMoJycsICdiZ20yJywgdHJ1ZSk7XG4gICAgfSxcbiAgICBnZXRDYW52TW9yZUhlaWdodCgpIHtcbiAgICAgICAgY29uc3Qgc2l6ZSA9IGNjLnZpZXcuZ2V0RnJhbWVTaXplKCk7XG4gICAgICAgIHRoaXMuaGVpZ2h0ID0gKCg2NjcgKiBzaXplLndpZHRoIC8gMzc1KSAtIHNpemUuaGVpZ2h0KSA+IDAgPyAwIDogKCg2NjcgKiBzaXplLndpZHRoIC8gMzc1KSAtIHNpemUuaGVpZ2h0KTtcbiAgICAgICAgdGhpcy53aWR0aCA9IHNpemUud2lkdGhcbiAgICB9LFxuXG4gICAgdG91Y2hTdGFydChlKSB7XG4gICAgICAgIGlmICh0aGlzLnJlbnd1LmRlYXRoKSByZXR1cm47XG4gICAgICAgIHRoaXMueWlkb25nZmlnID0gdHJ1ZTtcblxuICAgICAgICB0aGlzLnRvdWNoU3RhcnQgPSBlLmdldExvY2F0aW9uKCk7XG5cbiAgICAgICAgdGhpcy5jYW96dW9kaS5zdG9wQWxsQWN0aW9ucygpO1xuICAgICAgICB0aGlzLmNhb3p1b2RpLm9wYWNpdHkgPSAyNTU7XG4gICAgICAgIHRoaXMuY2FvenVvZGkueSA9IHRoaXMudG91Y2hTdGFydC55IC0gNjY3ICsgdGhpcy5oZWlnaHRcbiAgICAgICAgdGhpcy5jYW96dW9kaS54ID0gdGhpcy50b3VjaFN0YXJ0LnggLSAzNzVcbiAgICB9LFxuICAgIHRvdWNoTW92ZShlKSB7XG4gICAgICAgIGlmICh0aGlzLnJlbnd1LmRlYXRoIHx8ICF0aGlzLmdhbWVTdGFydCkge1xuICAgICAgICAgICAgdGhpcy55aWRvbmdmaWcgPSBmYWxzZTtcbiAgICAgICAgICAgIHJldHVyblxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBkZWx0YSA9IGUuZ2V0RGVsdGEoKTtcbiAgICAgICAgY29uc3QgYW5nbGUgPSB0aGlzLmFuZ2xlID0gd3hjdXIuZ2V0QW5nbGUoMCwgMCwgdGhpcy5jYW96dW9vcGFuLnggKyBkZWx0YS54LCB0aGlzLmNhb3p1b29wYW4ueSArIGRlbHRhLnkpXG4gICAgICAgIGNvbnN0IGh1ZHUgPSBhbmdsZSAqIE1hdGguUEkgLyAxODA7XG4gICAgICAgIGNvbnN0IHhpZWJpYW4gPSBNYXRoLnBvdyhNYXRoLnBvdyh0aGlzLmNhb3p1b29wYW4ueCArIGRlbHRhLngsIDIpICsgTWF0aC5wb3codGhpcy5jYW96dW9vcGFuLnkgKyBkZWx0YS55LCAyKSwgMC41KTtcbiAgICAgICAgY29uc3QgbWF4eGllYmlhbiA9IE1hdGgucG93KE1hdGgucG93KCgxOTEgLyAyKSAqIE1hdGguc2luKGh1ZHUpLCAyKSArIE1hdGgucG93KCgxODYgLyAyKSAqIE1hdGguY29zKGh1ZHUpLCAyKSwgMC41KTtcblxuICAgICAgICBpZiAoeGllYmlhbiA+PSBtYXh4aWViaWFuKSB7XG4gICAgICAgICAgICB0aGlzLmNhb3p1b29wYW4ueCA9ICgxOTEgLyAyKSAqIE1hdGguc2luKGh1ZHUpO1xuICAgICAgICAgICAgdGhpcy5jYW96dW9vcGFuLnkgPSAoMTg2IC8gMikgKiBNYXRoLmNvcyhodWR1KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY2FvenVvb3Bhbi54ICs9IGRlbHRhLng7XG4gICAgICAgICAgICB0aGlzLmNhb3p1b29wYW4ueSArPSBkZWx0YS55O1xuICAgICAgICB9XG4gICAgfSxcbiAgICB0b3VjaEVuZChlKSB7XG4gICAgICAgIHRoaXMueWlkb25nZmlnID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5jYW96dW9vcGFuLnkgPSAwO1xuICAgICAgICB0aGlzLmNhb3p1b29wYW4ueCA9IDA7XG4gICAgICAgIHRoaXMuY2FvenVvZGkucnVuQWN0aW9uKGNjLmZhZGVPdXQoMC41KSlcbiAgICB9LFxuICAgIHlkc2hpamlhbygpIHtcbiAgICAgICAgdGhpcy5jYW1lcmEueCA9IHRoaXMucmVud3Uubm9kZS54O1xuICAgICAgICB0aGlzLmNhbWVyYS55ID0gdGhpcy5yZW53dS5ub2RlLnk7XG4gICAgICAgIGlmICh0aGlzLnlpZG9uZ2ZpZykge1xuICAgICAgICAgICAgaW50ZXJhY3QuX3RoaXMuZ2FvZ3VhbmcueCA9IHRoaXMucmVud3Uubm9kZS54O1xuICAgICAgICAgICAgaW50ZXJhY3QuX3RoaXMuZ2FvZ3VhbmcueSA9IHRoaXMucmVud3Uubm9kZS55O1xuICAgICAgICAgICAgdGhpcy5yZW53dS55aWRvbmcodGhpcy5hbmdsZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnJlbnd1Lm5vZGUueWlkb25nZmlnID0gZmFsc2VcbiAgICAgICAgfVxuICAgIH0sXG4gICAgeWluZ2Nhbmcobm9kZSkge1xuICAgICAgICBjb25zdCBzaXplID0gY2Mudmlldy5nZXRGcmFtZVNpemUoKTtcbiAgICAgICAgY29uc3QgdjIgPSBnYW1lLl90aGlzLmNhbWVyYS5jb252ZXJ0VG9Ob2RlU3BhY2VBUihjYy52Mihub2RlLngsIG5vZGUueSkpO1xuICAgICAgICB2Mi54ICs9IHNpemUud2lkdGg7XG4gICAgICAgIHYyLnkgKz0gc2l6ZS5oZWlnaHQ7XG5cbiAgICAgICAgaWYgKHYyLnggPiAoc2l6ZS53aWR0aCArIG5vZGUud2lkdGggLyAyKSB8fCB2Mi54IDwgKC1zaXplLndpZHRoIC0gbm9kZS53aWR0aCAvIDIpIHx8IHYyLnkgPCAoLXNpemUuaGVpZ2h0IC0gbm9kZS5oZWlnaHQgLyAyKSB8fCB2Mi55ID4gKHNpemUuaGVpZ2h0ICsgbm9kZS5oZWlnaHQgLyAyKSkge1xuICAgICAgICAgICAgbm9kZS5vcGFjaXR5ID0gMFxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbm9kZS5vcGFjaXR5ID0gMjU1XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHVwZGF0ZSgpIHtcbiAgICAgICAgdGhpcy55ZHNoaWppYW8oKTtcbiAgICB9LFxufSk7XG5cblxuZXhwb3J0cy5nYW1lID0gZ2FtZTsiXX0=